WITH Joined_table AS (
  SELECT
    A.UserID,
    A.Gender,
    A.Age,
    A.Race,
    A.Province,
    B.Channel2,
    B.RecordDate2 AS RecordDate,
    date_format(
      to_timestamp(B.RecordDate2, 'yyyy/MM/dd HH:mm'),
      'HH:mm:ss'
    ) AS RecordDate2,
    date_format(
      B.`Duration 2`,
      'HH:mm:ss'
    ) AS RecordTime,
    CASE
      WHEN Age BETWEEN 18 AND 24 THEN 'Youth'
      WHEN Age BETWEEN 25 AND 34 THEN 'Young Adults'
      WHEN Age BETWEEN 35 AND 44 THEN 'Adults'
      ELSE 'Seniors'
    END AS Age_groups
  FROM
    bright_tv_user_profile_cleaned AS A
    FULL OUTER JOIN bright_tv_viewership_cleaned AS B
      ON A.UserID = B.UserID
)
SELECT 
  UserID,
  Age,
  Gender,
  Race,
  Province,
  Channel2,
  RecordDate2,
  Age_groups,
  CASE
    WHEN RecordTime BETWEEN '00:00:00' AND '08:00:00' THEN 'Morning'
    WHEN RecordTime BETWEEN '08:00:01' AND '12:00:00' THEN 'Day'
    WHEN RecordTime BETWEEN '12:00:01' AND '18:00:00' THEN 'Afternoon'
    ELSE 'Evening'
  END AS Time_buckets
FROM Joined_table;
